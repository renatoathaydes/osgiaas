import org.gradle.tooling.GradleConnector

apply plugin: 'java'
apply plugin: 'osgi'
apply plugin: 'maven'

version = '0.8'
sourceCompatibility = 1.8

repositories {
    jcenter()
    mavenLocal()
}

description = 'OSGiaaS Javac Runtime Compiler'

jar {
    manifest {
        instruction 'Export-Package', 'com.athaydes.osgiaas.javac'
    }
}

task prepareTestResources() {
    def connection = GradleConnector.newConnector()
            .forProjectDirectory( file( 'src/test/resources-generator/hello' ) )
            .connect()

    try {
        connection.newBuild().forTasks( "createResourceJar" )
                .setStandardOutput( System.out )
                .run()
    } finally {
        connection.close()
    }
}

tasks.test.dependsOn tasks.prepareTestResources

dependencies {
    compile 'org.slf4j:slf4j-api:1.7.21'
    compile project( ':modules:infra:osgiaas-common' )
    testCompile 'junit:junit:4.12'
}
