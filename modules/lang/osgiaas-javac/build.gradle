import org.gradle.tooling.GradleConnector

apply plugin: 'java'
apply plugin: 'osgi'
apply plugin: 'maven'

sourceCompatibility = 1.8

repositories {
    jcenter()
    mavenLocal()
}

jar {
    manifest {
        instruction 'Export-Package', 'com.athaydes.osgiaas.javac'
    }
}

task prepareTestResources() {
    def connection = GradleConnector.newConnector()
            .forProjectDirectory( file( 'src/test/resources-generator/hello' ) )
            .connect()

    try {
        connection.newBuild().forTasks( "createResourceJar" )
                .setStandardOutput( System.out )
                .run()
    } finally {
        connection.close()
    }
}

tasks.test.dependsOn tasks.prepareTestResources

dependencies {
    testCompile 'junit:junit:4.12'
}
